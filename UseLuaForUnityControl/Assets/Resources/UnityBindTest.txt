--Unity側から呼ばれ、Unity側の処理を呼び出す--Unity〜というのは、Unity側から関数の登録がされていないと使えない（というか、処理がない）

QuestCount = 5
ScreenWidth = ""
ScreenHeight = ""

--LuaのMain関数みたいな奴
function LuaMain()
	LuaChangeScene("Title", "MainCanvas")
	LuaLoadPrefabAfter("Prefabs/System/FadeObject", "", "SystemCanvas")
	LuaLoadPrefabAfter("Prefabs/HeaderObject", "", "HeaderFooterCanvas")
	LuaLoadPrefabAfter("Prefabs/FooterObject", "", "HeaderFooterCanvas")
	LuaSetActive("HeaderObject", false)
	LuaSetActive("FooterObject", false)
end

--ゲームの情報
function SetUnityGameData(screenWidth, screenHeight)
	ScreenWidth = screenWidth
	ScreenHeight = screenHeight
end

function LuaUnityDebugLog(log)
	UnityDebugLog(log)
end

--オブジェクト破棄
--引数：ヒエラルキに登録しているオブジェクト名を指定する
--結果：Unity側のヒエラルキオブジェクトディクショナリから削除する
function LuaDestroyObject(hierarchyName)
	UnityDestroyObject(hierarchyName)
end

--オブジェクト検索
--引数：ヒエラルキに登録しているオブジェクト名を指定する
--結果：Unity側のヒエラルキオブジェクトディクショナリに登録されて、アクセス可能になる
function LuaFindObject(hierarchyName)
	UnityFindObject(hierarchyName)
end

--アニメーション再生
--引数：オブジェクト名、アニメーション名、アニメーションが終わった後のLua側のコールバック関数名
function LuaPlayAnimator(hierarchyName, animationName, callbackMethodName)
	UnityPlayAnimator(hierarchyName, animationName, callbackMethodName)
end

--シーンオブジェクトの切り替え
--引数：シーン名、SetParentしたい親のオブジェクト名
function LuaChangeScene(sceneName, parentHierarchyName)
	UnityChangeScene(sceneName, parentHierarchyName)
end

--ローテーションの設定
--引数：hierarchy名と、x,y,zの回転角度(degree)
function LuaSetRotate(hierarchyName, x, y, z)
	UnitySetRotate(hierarchyName, x, y, z)
end

--アクティブの切り替え
--引数：
function LuaSetActive(hierarchyName, active)
	UnitySetActive(hierarchyName, active)
end

--プレハブをロードするだけ
function LuaLoadPrefabAfter(prefabPath, hierarchyName, parentHierarchyName)
	UnityLoadPrefabAfter(prefabPath, hierarchyName, parentHierarchyName)
end

--プレハブのロード
function LuaLoadPrefab(prefabName)
	UnityLoadPrefab(prefabName)
end

--シーンの切り替え
function LuaLoadLevel(sceneName)
	UnityLoadLevel(sceneName)
end

--他のLuaの関数を呼び出す
function LuaCallLuaFunction(fileName, functionName)
	UnityCallLuaFunction(fileName, functionName)
end

--基本Lua関数を使えるようにする
function LuaBindCommonFunction(fileName)
	UnityBindCommonFunction(fileName)
end

--Luaファイルを読み込んで、アクセスできる状態にする
function LoadLuaFile(filename)
	UnityLoadLuaFile(filename)
end

--Unity側から呼び出される。Event系の関数
function EventClickButton(eventName)
	if eventName == "TitleSceneGoHomeButton" then
		LuaPlayAnimator("FadeObject", "FadeIn", "TitleScene_ClickHome_Callback")
	elseif eventName == "HomeButton" then
		LuaPlayAnimator("FadeObject", "FadeIn", "Footer_ClickHome_Callback")
	elseif eventName == "CustomButton" then
		LuaPlayAnimator("FadeObject", "FadeIn", "Footer_ClickCustom_Callback")
	elseif eventName == "QuestButton" then
		LuaPlayAnimator("FadeObject", "FadeIn", "Footer_ClickQuest_Callback")
	elseif eventName == "OptionButton" then
		LuaPlayAnimator("FadeObject", "FadeIn", "Footer_ClickOption_Callback")
	elseif eventName == "QuestSelectListNode0" then
		LuaPlayAnimator("FadeObject", "FadeIn", "QuestScene_ClickButton_Callback")
	elseif eventName == "BattleOptionButton" then
		LuaPlayAnimator("FadeObject", "FadeIn", "BattleScene_ClickBackButton_Callback")
	end
end

--タイトルシーン関数
--ホームへ行く
function TitleScene_ClickHome_Callback()
	LuaChangeScene("Home", "MainCanvas")
	LuaSetActive("HeaderObject", true)
	LuaSetActive("FooterObject", true)
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end

--フッターボタン関数
function Footer_ClickHome_Callback()
	LuaChangeScene("Home", "MainCanvas")
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end
function Footer_ClickCustom_Callback()
	LuaChangeScene("Custom", "MainCanvas")
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end
function Footer_ClickQuest_Callback()
	LuaChangeScene("Quest", "MainCanvas")
	LuaFindObject("QuestScrollContent")
	for i = 0, QuestCount-1 do
		LuaDestroyObject("QuestSelectListNode"..i, "QuestScrollContent")
	end

	for i = 0, QuestCount-1 do
		LuaLoadPrefabAfter("Prefabs/QuestSelectListNode", "QuestSelectListNode"..i, "QuestScrollContent")
		LuaSetActive("QuestSelectListNode"..i, true)
	end
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end
function Footer_ClickOption_Callback()
	LuaChangeScene("Option", "MainCanvas")
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end

--クエストシーン関数
function QuestScene_ClickButton_Callback()
	LuaChangeScene("Battle", "MainCanvas")
	LuaSetActive("HeaderObject", false)
	LuaSetActive("FooterObject", false)
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end

--バトルシーン関数
function BattleScene_ClickBackButton_Callback()
	LuaChangeScene("Home", "MainCanvas")
	LuaSetActive("HeaderObject", true)
	LuaSetActive("FooterObject", true)
	LuaFindObject("PlayerCharacter")
	LuaPlayAnimator("FadeObject", "FadeOut", "")
end

function BattleOnMouseDown(touchx, touchy)
	offsetx = touchx - (ScreenWidth/2)
	offsety = touchy - (ScreenHeight/2)

	radian = math.atan2(offsety, offsetx)
	degree = radian * 180 / 3.1415
	LuaUnityDebugLog(degree)
	LuaSetRotate("PlayerCharacter", 0, 0, degree-90)
end

function BattleOnMouseDrag(touchx, touchy)
	offsetx = touchx - (ScreenWidth/2)
	offsety = touchy - (ScreenHeight/2)

	radian = math.atan2(offsety, offsetx)
	degree = radian * 180 / 3.1415
	LuaUnityDebugLog(degree)
	LuaSetRotate("PlayerCharacter", 0, 0, degree-90)
end

--ホームシーン関数

